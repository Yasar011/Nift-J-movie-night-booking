<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Night Booking</title>
    <style>
        /* General Styles */
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom, #1c1c1c, #343a40);
            color: #fff;
            margin: 0;
            padding: 0;
        }

        header {
            text-align: center;
            padding: 20px;
            background: #007bff;
            color: #fff;
        }

        header img {
            max-width: 60px;
            margin-bottom: 10px;
        }

        header h1 {
            margin: 10px 0;
            font-size: 2.5em;
        }

        header p {
            font-size: 1.2em;
        }

        header button {
            background: #ffc107;
            border: none;
            padding: 10px 20px;
            font-size: 1em;
            border-radius: 5px;
            cursor: pointer;
        }

        header button:hover {
            background: #e0a800;
        }

        main {
            padding: 20px;
        }

        .screen {
            margin: 10px auto;
            padding: 10px;
            width: 80%;
            background: #444;
            color: #fff;
            text-align: center;
            font-weight: bold;
            border-radius: 10px;
            font-size: 1.2em;
        }

        .row {
            display: flex;
            justify-content: center;
            margin: 10px 0;
        }

        .seat {
            width: 40px;
            height: 40px;
            margin: 5px;
            background: #6c757d;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            cursor: pointer;
        }

        .seat.selected {
            background: #28a745;
        }

        .seat.occupied {
            background: #dc3545;
            cursor: not-allowed;
        }

        .form-container {
            margin: 20px auto;
            padding: 20px;
            background: #444;
            border-radius: 10px;
            max-width: 500px;
        }

        form select, form input, form button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            font-size: 1em;
        }

        form select, form input {
            background: #f8f9fa;
        }

        form button {
            background: #007bff;
            color: #fff;
            cursor: pointer;
        }

        form button:hover {
            background: #0056b3;
        }

        .booking-warning {
            color: #ffc107;
            text-align: center;
            margin-top: 10px;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <header>
        <img src="file:///C:/Users/HP/Desktop/movie%20wb/r/NIFT%20logo.jpg" alt="College Logo">
        <h1>Movie Night Booking</h1>
        <p id="movieDetails">"Movie " | Show Time: 9:30 PM</p>
        <button id="adminButton">Admin Panel</button>
    </header>
    <main>
        <h2 style="text-align: center;">Seating Chart</h2>
        <div class="screen">Screen</div>
        <div class="seating-chart" id="seatingChart">
            <!-- Rows will be generated dynamically -->
        </div>
        <div class="form-container">
            <form id="bookingForm">
                <input type="text" id="name" placeholder="Your Name" required />
                <input type="email" id="email" placeholder="Your Email" required />
                <select id="department" required>
                    <option value="">Select Department</option>
                    <option value="BFT">BFT</option>
                    <option value="AD">AD</option>
                    <option value="FD">FD</option>
                    <option value="TD">TD</option>
                    <option value="MFM">MFM</option>
                    <option value="FC">FC</option>
                </select>
                <select id="semester" required>
                    <option value="">Select Semester</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                </select>
                <button type="submit">Book Ticket</button>
            </form>
        </div>
        <div class="booking-warning" id="bookingWarning"></div>
    </main>

    <script>
        // Fetch seat availability from backend
        fetch('http://localhost:5000/seats')
            .then(response => response.json())
            .then(data => {
                const seatingChart = document.getElementById('seatingChart');
                data.forEach((row, rowIndex) => {
                    const rowElement = document.createElement('div');
                    rowElement.classList.add('row');
                    row.forEach((seat, colIndex) => {
                        const seatElement = document.createElement('div');
                        seatElement.classList.add('seat');
                        seatElement.textContent = `${String.fromCharCode(65 + rowIndex)}${colIndex + 1}`;
                        if (seat) {
                            seatElement.classList.add('occupied');
                        }
                        rowElement.appendChild(seatElement);
                    });
                    seatingChart.appendChild(rowElement);
                });
            });

        // Seat Selection Logic
        const seatingChart = document.getElementById('seatingChart');
        const bookingForm = document.getElementById('bookingForm');
        const bookingWarning = document.getElementById('bookingWarning');

        seatingChart.addEventListener('click', (e) => {
            if (!e.target.classList.contains('seat') || e.target.classList.contains('occupied')) {
                return;
            }
            e.target.classList.toggle('selected');
            const selectedSeats = document.querySelectorAll('.seat.selected');
            if (selectedSeats.length > 2) {
                e.target.classList.remove('selected');
                bookingWarning.textContent = 'You can only select two seats at a time.';
            } else {
                bookingWarning.textContent = '';
            }
        });

        // Booking Form Submission
       // Booking Form Submission
bookingForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const selectedSeats = document.querySelectorAll('.seat.selected');
    if (selectedSeats.length !== 2) {
        bookingWarning.textContent = 'Please select exactly two seats.';
        return;
    }

    const name = document.getElementById('name').value;
    const email = document.getElementById('email').value;
    const department = document.getElementById('department').value;
    const semester = document.getElementById('semester').value;

    selectedSeats.forEach(seat => {
        seat.classList.remove('selected');
        seat.classList.add('occupied');
        const seatId = seat.textContent;
        const [row, col] = seatId.match(/[A-Z]+|[0-9]+/g);

        fetch('http://localhost:5000/book-seat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                row: row.charCodeAt(0) - 65, // Convert 'A' -> 0, 'B' -> 1, etc.
                col: col - 1,
                name,
                email,
                department,
                semester
            }),
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
            // Redirect to your Google Form after booking
            window.location.href = 'https://docs.google.com/forms/d/e/1FAIpQLSd0m89yBYsKqXS1Bni_W0nqbRVs2Gc8uaLlHAg9VXGVJlxQBQ/viewform?usp=header';
        })
        .catch(error => {
            alert('Error booking seat');
        });
    });
});


    </script>
</body>
</html>
